with recursive  rec_tree as (
select cp.parent_id, cp.child_id
from category_parent cp
where cp.parent_id  = 3

union all

select  cp2.parent_id , cp2.child_id
from category_parent cp2
join rec_tree on cp2.parent_id = rec_tree.child_id
)
select distinct p."name" , pc.product_id
from product p
join product_category pc on pc.product_id = p.id
where category_id in (select child_id   from rec_tree union select parent_id  from rec_tree)
